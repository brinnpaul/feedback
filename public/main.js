'use strict';

window.app = angular.module('MyApp', ['ui.router', 'ui.bootstrap', 'ngAnimate', 'ngKookies']);

app.config(function ($urlRouterProvider, $locationProvider, $kookiesProvider) {
  // This turns off hashbang urls (/#about) and changes it to something normal (/about)
  $locationProvider.html5Mode(true);
  // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
  $urlRouterProvider.otherwise('/');
  // Trigger page refresh when accessing an OAuth route
  $urlRouterProvider.when('/auth/:provider', function () {
    window.location.reload();
  });

  $kookiesProvider.config.json = true;
});

app.config(function ($stateProvider) {
  $stateProvider.state('student', {
    url: '/student',
    templateUrl: 'js/views/student/student.html'
  });
});

app.config(function ($stateProvider) {
  $stateProvider.state('admin', {
    url: '/admin',
    templateUrl: 'js/views/instructor/instructor.html'
  });
});

app.config(function ($stateProvider) {
  $stateProvider.state('summary', {
    url: '/summary',
    templateUrl: 'js/views/summary/summary.html'
  });
});

app.controller('LoginCtrl', function ($scope, $state) {

  console.log("reached login ctrl");
  $scope.loginStatus = function () {
    console.log("reached login status");
    var temp = $scope.login;
    console.log("temp: ", temp);

    if (temp === 'admin') {
      $state.go('admin');
    } else if (temp === 'student') {
      $state.go('student');
    } else if (temp === 'summary') {
      $state.go('summary');
    }
  };
});

var socket = io(window.location.origin);
app.controller('CreatePoll', function ($scope, $uibModal) {

  $scope.showModal = function () {

    $scope.opts = {
      backdrop: true,
      backdropClick: true,
      transclude: true,
      dialogFade: false,
      keyboard: true,
      templateUrl: 'js/common/createPollModal/createPollModal.html',
      controller: ModalInstanceCtrl,
      resolve: {} // empty storage
    };

    $scope.opts.resolve.item = function () {
      return angular.copy({ polls: $scope.polls }); // pass name to Dialog
    };

    var modalInstance = $uibModal.open($scope.opts);

    modalInstance.result.then(function () {
      //on ok button press
    }, function () {
      //on cancel button press
    });
  };
});

var ModalInstanceCtrl = function ModalInstanceCtrl($scope, $uibModalInstance, $uibModal, item, PollFactory) {

  $scope.item = item;

  $scope.customOptions = function (option) {
    $scope.customShow = option === 'custom';
  };

  $scope.submitPoll = function () {
    var poll = {};
    poll.question = $scope.newPoll;
    poll.lectureId = 1;
    if ($scope.option == 'custom') poll.options = [$scope.a, $scope.b, $scope.c, $scope.d];

    PollFactory.createPoll(poll).then(function () {
      return PollFactory.getAllByLectureId(1);
    }).then(function (polls) {
      $scope.polls = polls;
    }).then(function () {
      $uibModalInstance.close();
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
};

app.directive('feedback', function ($state, FeedbackFactory) {
  return {
    restrict: 'E',
    scope: {},
    templateUrl: 'js/common/feedback/feedback.html',
    link: function link(scope) {
      scope.addMessage = false;
      scope.rejectMessage = false;

      scope.countFeedback = function (category) {
        if (category === 'Great' && !scope.greatCount || category === 'Confused' && !scope.confusedCount || category === 'Example' && !scope.exampleCount || category === 'Cannot See' && !scope.seeCount || category === 'Cannot Hear' && !scope.hearCount || category === 'Request Break' && !scope.breakCount) {
          return FeedbackFactory.addFeedback(category).then(function () {
            return FeedbackFactory.countFeedback(category);
          }).then(function (result) {
            socket.emit('submittedFeedback', category);

            console.log('IT IS HERE', result);
            if (category === 'Great') {
              scope.greatCount = result;
            }
            if (category === 'Confused') {
              scope.confusedCount = result;
            }
            if (category === 'Example') {
              scope.exampleCount = result;
            }
            if (category === 'Cannot See') {
              scope.seeCount = result;
            }
            if (category === 'Cannot Hear') {
              scope.hearCount = result;
            }
            if (category === 'Request Break') {
              scope.breakCount = result;
            }
          }).then(function () {
            scope.addMessage = true;
            setTimeout(function () {
              scope.addMessage = false;
              scope.$digest();
            }, 1500);
          }).then(function () {
            setTimeout(function () {
              scope.greatCount = null;
              scope.confusedCount = null;
              scope.exampleCount = null;
              scope.seeCount = null;
              scope.hearCount = null;
              scope.breakCount = null;
              scope.$digest();
            }, 30 * 1000);
          });
        } else {
          scope.rejectMessage = true;
          setTimeout(function () {
            scope.rejectMessage = false;
            scope.$digest();
          }, 1500);
        }
      };

      socket.on('updateFeedback', function (category) {
        console.log('received -->', category);

        return FeedbackFactory.countFeedback(category).then(function (result) {
          if (category === 'Great') {
            scope.greatCount = result;
          }
          if (category === 'Confused') {
            scope.confusedCount = result;
          }
          if (category === 'Example') {
            scope.exampleCount = result;
          }
          if (category === 'Cannot See') {
            scope.seeCount = result;
          }
          if (category === 'Cannot Hear') {
            scope.hearCount = result;
          }
          if (category === 'Request Break') {
            scope.breakCount = result;
          }
        }).then(function () {
          setTimeout(function () {
            scope.greatCount = null;
            scope.confusedCount = null;
            scope.exampleCount = null;
            scope.seeCount = null;
            scope.hearCount = null;
            scope.breakCount = null;
            scope.$digest();
          }, 30 * 1000);
        });
        // scope.$digest()
      });
    }
  };
});

app.factory('FeedbackFactory', function ($http) {
  var FeedbackFactory = {};

  FeedbackFactory.addFeedback = function (category) {
    return $http.post('/api/feedback/', { category: category }).then(function (result) {
      console.log('gotHERE', result);
    });
  };

  FeedbackFactory.countFeedback = function (category) {
    return $http.get('/api/feedback/count/' + category).then(function (result) {
      return result.data;
    });
  };

  return FeedbackFactory;
});
app.directive('poll', function ($state, PollFactory) {
  return {
    restrict: 'E',
    scope: {
      useCtrl: "@"
    },
    templateUrl: 'js/common/poll/poll.html',
    link: function link(scope) {

      scope.delete = PollFactory.deletePoll;

      PollFactory.getAllByLectureId(1).then(function (currentPolls) {
        scope.polls = currentPolls;
      });

      scope.sendPoll = function (poll) {
        socket.emit('pollOut', poll);
      };
    }
  };
});

app.factory('PollFactory', function ($http) {
  function dotData(dot) {
    return dot.data;
  }
  var cachedPolls = [];
  return {
    getAllByLectureId: function getAllByLectureId(id) {
      return $http.get('/api/poll/lecture/' + id).then(dotData).then(function (polls) {
        angular.copy(polls, cachedPolls);
        return cachedPolls;
      });
    },
    getOneByPollId: function getOneByPollId(id) {
      return $http.get('/api/poll/' + id).then(dotData);
    },
    createPoll: function createPoll(pollObj) {
      return $http.post('/api/poll/', pollObj).then(dotData);
    },
    updatePoll: function updatePoll(pollObj, id) {
      return $http.put('/api/poll/' + id, pollObj).then(dotData);
    },
    deletePoll: function deletePoll(id) {
      return $http.delete('/api/poll/' + id).then(dotData).then(function (removedPoll) {
        cachedPolls.splice(cachedPolls.map(function (item) {
          return item.id;
        }).indexOf(id), 1);
        return cachedPolls;
      });
    }
  };
});

app.controller('StudentPoll', function ($scope, $uibModal) {
  $scope.showModal = function () {

    $scope.opts = {
      backdrop: true,
      backdropClick: true,
      transclude: true,
      dialogFade: false,
      keyboard: true,
      templateUrl: 'js/common/studentModal/studentPoll.html',
      controller: StudentModalInstance,
      resolve: {} // empty storage
    };

    $scope.opts.resolve.item = function () {
      return angular.copy({ poll: $scope.poll }); // pass name to Dialog
    };

    var modalInstance = $uibModal.open($scope.opts);

    modalInstance.result.then(function () {
      //on ok button press
    }, function () {
      //on cancel button press
    });
  };

  socket.on('toStudent', function (pollQuestion) {
    $scope.poll = pollQuestion;
    $scope.showModal();
  });
});

function StudentModalInstance($scope, $uibModalInstance, $uibModal, item, PollFactory) {

  $scope.item = item;

  socket.on('toStudent', function (pollQuestion) {
    $scope.poll = pollQuestion;
  });

  $scope.submitAnswer = function () {
    $uibModalInstance.close();
  };
}

app.directive('question', function ($state, QuestionFactory) {

  return {
    restrict: 'E',
    scope: {},
    templateUrl: 'js/common/question/question.html',
    link: function link(scope) {

      QuestionFactory.getAllByLectureId(1).then(function (questions) {
        scope.questions = questions.filter(function (q) {
          return q.status === 'open';
        });
      });

      function findIndex(question) {
        for (var i = 0; i < scope.questions.length; i++) {
          if (scope.questions[i].text === question.text) {
            return i;
          }
        }
        return -1;
      }

      function move(question, n) {
        var index = findIndex(question);
        if (index + n > -1 && index + n < scope.questions.length) {
          scope.questions.splice(index, 1);
          scope.questions.splice(index + n, 0, question);
        }
      }

      scope.submit = function () {
        if (scope.newQuestion) {
          var question = { text: scope.newQuestion, submitTime: Date.now(), upvotes: 0 };
          return QuestionFactory.store(question).then(function (q) {
            socket.emit('addingQuestion', q);
            scope.newQuestion = null;
          });
        }
      };

      scope.delete = function (question) {
        socket.emit('deletingQuestion', question);
        return QuestionFactory.delete(question);
      };

      scope.close = function (question) {
        question.status = 'closed';
        return QuestionFactory.update(question).then(function () {
          socket.emit('deletingQuestion', question);
        });
      };

      scope.move = function (question, n) {
        socket.emit('move', question, n);
      };

      scope.upvote = function (question) {
        question.hasUpvoted = !question.hasUpvoted;
        question.upvotes++;
        socket.emit('upvoting', question);
        return QuestionFactory.update(question);
      };

      scope.downvote = function (question) {
        question.hasUpvoted = !question.hasUpvoted;
        question.upvotes--;
        socket.emit('downvoting', question);
        return QuestionFactory.update(question);
      };

      socket.on('addQuestion', function (question) {
        scope.questions.unshift(question);
        scope.$evalAsync();
      });

      socket.on('deleteQuestion', function (question) {
        var index = findIndex(question);
        scope.questions.splice(index, 1);
        scope.$evalAsync();
      });

      socket.on('receivedUpvote', function (question) {
        var index = findIndex(question);
        var question = scope.questions[index];
        question.upvotes++;
        scope.$evalAsync();
      });

      socket.on('receivedDownvote', function (question) {
        var index = findIndex(question);
        var question = scope.questions[index];
        question.upvotes--;
        scope.$evalAsync();
      });

      socket.on('moving', function (question, n) {
        move(question, n);
        scope.$evalAsync();
      });
    }
  };
});

app.factory('QuestionFactory', function ($http) {

  var obj = {};

  obj.getAllByLectureId = function (lectureId) {
    return $http.get('/api/question/lecture/' + lectureId).then(function (res) {
      return res.data;
    });
  };

  obj.store = function (question) {
    return $http.post('/api/question', question).then(function (res) {
      return res.data;
    });
  };

  obj.update = function (question) {
    return $http.put('/api/question/' + question.id, question).then(function (res) {
      return res.data;
    });
  };

  obj.delete = function (question) {
    return $http.delete('/api/question/' + question.id).then(function (res) {
      return res.data;
    });
  };

  return obj;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNvY2tldC5qcyIsImNvbW1vbi9jcmVhdGVQb2xsTW9kYWwvY3JlYXRlUG9sbC5jb250cm9sbGVyLmpzIiwiY29tbW9uL2ZlZWRiYWNrL2ZlZWRiYWNrLmRpcmVjdGl2ZS5qcyIsImNvbW1vbi9mZWVkYmFjay9mZWVkYmFjay5mYWN0b3J5LmpzIiwiY29tbW9uL3BvbGwvcG9sbC5kaXJlY3RpdmUuanMiLCJjb21tb24vcG9sbC9wb2xsLmZhY3RvcnkuanMiLCJjb21tb24vc3R1ZGVudE1vZGFsL3N0dWRlbnRQb2xsLmNvbnRyb2xsZXIuanMiLCJjb21tb24vcXVlc3Rpb24vcXVlc3Rpb24uZGlyZWN0aXZlLmpzIiwiY29tbW9uL3F1ZXN0aW9uL3F1ZXN0aW9uLmZhY3RvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsT0FBQSxHQUFBLEdBQUEsUUFBQSxNQUFBLENBQUEsT0FBQSxFQUFBLENBQUEsV0FBQSxFQUFBLGNBQUEsRUFBQSxXQUFBLEVBQUEsV0FBQSxDQUFBLENBQUE7O0FBRUEsSUFBQSxNQUFBLENBQUEsVUFBQSxrQkFBQSxFQUFBLGlCQUFBLEVBQUEsZ0JBQUEsRUFBQTs7QUFFQSxvQkFBQSxTQUFBLENBQUEsSUFBQTs7QUFFQSxxQkFBQSxTQUFBLENBQUEsR0FBQTs7QUFFQSxxQkFBQSxJQUFBLENBQUEsaUJBQUEsRUFBQSxZQUFBO0FBQ0EsV0FBQSxRQUFBLENBQUEsTUFBQTtBQUNBLEdBRkE7O0FBSUEsbUJBQUEsTUFBQSxDQUFBLElBQUEsR0FBQSxJQUFBO0FBRUEsQ0FaQTs7QUFjQSxJQUFBLE1BQUEsQ0FBQSxVQUFBLGNBQUEsRUFBQTtBQUNBLGlCQUFBLEtBQUEsQ0FBQSxTQUFBLEVBQUE7QUFDQSxTQUFBLFVBREE7QUFFQSxpQkFBQTtBQUZBLEdBQUE7QUFJQSxDQUxBOztBQU9BLElBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsaUJBQUEsS0FBQSxDQUFBLE9BQUEsRUFBQTtB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QUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsZUFBQSxFQUFBO0FBQ0EsU0FBQTtBQUNBLGNBQUEsR0FEQTtBQUVBLFdBQUEsRUFGQTtBQUtBLGlCQUFBLGtDQUxBO0FBTUEsVUFBQSxjQUFBLEtBQUEsRUFBQTtBQUNBLFlBQUEsVUFBQSxHQUFBLEtBQUE7QUFDQSxZQUFBLGFBQUEsR0FBQSxLQUFBOztBQUVBLFlBQUEsYUFBQSxHQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsWUFBQSxhQUFBLE9BQUEsSUFBQSxDQUFBLE1BQUEsVUFBQSxJQUFBLGFBQUEsVUFBQSxJQUFBLENBQUEsTUFBQSxhQUFBLElBQUEsYUFBQSxTQUFBLElBQUEsQ0FBQSxNQUFBLFlBQUEsSUFBQSxhQUFBLFlBQUEsSUFBQSxDQUFBLE1BQUEsUUFBQSxJQUFBLGFBQUEsYUFBQSxJQUFBLENBQUEsTUFBQSxTQUFBLElBQUEsYUFBQSxlQUFBLElBQUEsQ0FBQSxNQUFBLFVBQUEsRUFBQTtBQUNBLGlCQUFBLGdCQUFBLFdBQUEsQ0FBQSxRQUFBLEVBQ0EsSUFEQSxDQUNBLFlBQUE7QUFDQSxtQkFBQSxnQkFBQSxhQUFBLENBQUEsUUFBQSxDQUFBO0FBQ0EsV0FIQSxFQUlBLElBSkEsQ0FJQSxVQUFBLE1BQUEsRUFBQTtBQUNBLG1CQUFBLElBQUEsQ0FBQSxtQkFBQSxFQUFBLFFBQUE7O0FBRUEsb0JBQUEsR0FBQSxDQUFBLFlBQUEsRUFBQSxNQUFBO0FBQ0EsZ0JBQUEsYUFBQSxPQUFBLEVBQUE7QUFDQSxvQkFBQSxVQUFBLEdBQUEsTUFBQTtBQUNBO0FBQ0EsZ0JBQUEsYUFBQSxVQUFBLEVBQUE7QUFDQSxvQkFBQSxhQUFBLEdBQUEsTUFBQTtBQUNBO0FBQ0EsZ0JBQUEsYUFBQSxTQUFBLEVBQUE7QUFDQSxvQkFBQSxZQUFBLEdBQUEsTUFBQTtBQUNBO0FBQ0EsZ0JBQUEsYUFBQSxZQUFBLEVBQUE7QUFDQSxvQkFBQSxRQUFBLEdBQUEsTUFBQTtBQUNBO0FBQ0EsZ0JBQUEsYUFBQSxhQUFBLEVBQUE7QUFDQSxvQkFBQSxTQUFBLEdBQUEs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QSxDQUFBLEVBQUE7QUFDQSxZQUFBLFFBQUEsVUFBQSxRQUFBLENBQUE7QUFDQSxZQUFBLFFBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxJQUFBLFFBQUEsQ0FBQSxHQUFBLE1BQUEsU0FBQSxDQUFBLE1BQUEsRUFBQTtBQUNBLGdCQUFBLFNBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxFQUFBLENBQUE7QUFDQSxnQkFBQSxTQUFBLENBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxRQUFBO0FBQ0E7QUFDQTs7QUFFQSxZQUFBLE1BQUEsR0FBQSxZQUFBO0FBQ0EsWUFBQSxNQUFBLFdBQUEsRUFBQTtBQUNBLGNBQUEsV0FBQSxFQUFBLE1BQUEsTUFBQSxXQUFBLEVBQUEsWUFBQSxLQUFBLEdBQUEsRUFBQSxFQUFBLFNBQUEsQ0FBQSxFQUFBO0FBQ0EsaUJBQUEsZ0JBQUEsS0FBQSxDQUFBLFFBQUEsRUFBQSxJQUFBLENBQUEsVUFBQSxDQUFBLEVBQUE7QUFDQSxtQkFBQSxJQUFBLENBQUEsZ0JBQUEsRUFBQSxDQUFBO0FBQ0Esa0JBQUEsV0FBQSxHQUFBLElBQUE7QUFDQSxXQUhBLENBQUE7QUFJQTtBQUNBLE9BUkE7O0FBVUEsWUFBQSxNQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxlQUFBLElBQUEsQ0FBQSxrQkFBQSxFQUFBLFFBQUE7QUFDQSxlQUFBLGdCQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUE7QUFDQSxPQUhBOztBQUtBLFlBQUEsS0FBQSxHQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsaUJBQUEsTUFBQSxHQUFBLFFBQUE7QUFDQSxlQUFBLGdCQUFBLE1BQUEsQ0FBQSxRQUFBLEVBQUEsSUFBQSxDQUFBLFlBQUE7QUFDQSxpQkFBQSxJQUFBLENBQUEsa0JBQUEsRUFBQSxRQUFBO0FBQ0EsU0FGQSxDQUFBO0FBR0EsT0FMQTs7QUFPQSxZQUFBLElBQUEsR0FBQSxVQUFBLFFBQUEsRUFBQSxDQUFBLEVBQUE7QUFDQSxlQUFBLElBQUEsQ0FBQSxNQUFBLEVBQUEsUUFBQSxFQUFBLENBQUE7QUFDQSxPQUZBOztBQUlBLFlBQUEsTUFBQSxHQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsaUJBQUEsVUFBQSxHQUFBLENBQUEsU0FBQSxVQUFBO0FBQ0EsaUJBQUEsT0FBQTtBQUNBLGVBQUEsSUFBQSxDQUFBLFVBQUEsRUFBQSxRQUFBO0FBQ0EsZUFBQSxnQkFBQSxNQUFBLENBQUEsUUFBQSxDQUFBO0FBQ0EsT0FMQTs7QUFPQSxZQUFBLFFBQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLGlCQUFBLFVBQUEsR0FBQSxDQUFBLFNBQUEsVUFBQTtBQUNBLGlCQUFBLE9BQUE7QUFDQSxlQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsUUFBQTtBQUNBLGVBQUEsZ0JBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQTtBQUNBLE9BTEE7O0FBT0EsYUFBQSxFQUFBLENBQUEsYUFBQSxFQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsY0FBQSxTQUFBLENBQUEsT0FBQSxDQUFBLFFBQUE7QUFDQSxjQUFBLFVBQUE7QUFDQSxPQUhBOztBQUtBLGFBQUEsRUFBQSxDQUFBLGdCQUFBLEVBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxZQUFBLFFBQUEsVUFBQSxRQUFBLENBQUE7QUFDQSxjQUFBLFNBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxFQUFBLENBQUE7QUFDQSxjQUFBLFVBQUE7QUFDQSxPQUpBOztBQU1BLGFBQUEsRUFBQSxDQUFBLGdCQUFBLEVBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxZQUFBLFFBQUEsVUFBQSxRQUFBLENBQUE7QUFDQSxZQUFBLFdBQUEsTUFBQSxTQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0EsaUJBQUEsT0FBQTtBQUNBLGNBQUEsVUFBQTtBQUNBLE9BTEE7O0FBT0EsYUFBQSxFQUFBLENBQUEsa0JBQUEsRUFBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLFlBQUEsUUFBQSxVQUFBLFFBQUEsQ0FBQTtBQUNBLFlBQUEsV0FBQSxNQUFBLFNBQUEsQ0FBQSxLQUFBLENBQUE7QUFDQSxpQkFBQSxPQUFBO0FBQ0EsY0FBQSxVQUFBO0FBQ0EsT0FMQTs7QUFPQSxhQUFBLEVBQUEsQ0FBQSxRQUFBLEVBQUEsVUFBQSxRQUFBLEVBQUEsQ0FBQSxFQUFBO0FBQ0EsYUFBQSxRQUFBLEVBQUEsQ0FBQTtBQUNBLGNBQUEsVUFBQTtBQUNBLE9BSEE7QUFJQTtBQXBHQSxHQUFBO0FBc0dBLENBeEdBOztBQ0FBLElBQUEsT0FBQSxDQUFBLGlCQUFBLEVBQUEsVUFBQSxLQUFBLEVBQUE7O0FBRUEsTUFBQSxNQUFBLEVBQUE7O0FBRUEsTUFBQSxpQkFBQSxHQUFBLFVBQUEsU0FBQSxFQUFBO0FBQ0EsV0FBQSxNQUFBLEdBQUEsQ0FBQSwyQkFBQSxTQUFBLEVBQUEsSUFBQSxDQUFBLFVBQUEsR0FBQSxFQUFBO0FBQ0EsYUFBQSxJQUFBLElBQUE7QUFDQSxLQUZBLENBQUE7QUFHQSxHQUpBOztBQU1BLE1BQUEsS0FBQSxHQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsV0FBQSxNQUFBLElBQUEsQ0FBQSxlQUFBLEVBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxVQUFBLEdBQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxJQUFBO0FBQ0EsS0FGQSxDQUFBO0FBR0EsR0FKQTs7QUFNQSxNQUFBLE1BQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLFdBQUEsTUFBQSxHQUFBLENBQUEsbUJBQUEsU0FBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxVQUFBLEdBQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxJQUFBO0FBQ0EsS0FGQSxDQUFBO0FBR0EsR0FKQTs7QUFNQSxNQUFBLE1BQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLFdBQUEsTUFBQSxNQUFBLENBQUEsbUJBQUEsU0FBQSxFQUFBLEVBQUEsSUFBQSxDQUFBLFVBQUEsR0FBQSxFQUFBO0FBQ0EsYUFBQSxJQUFBLElBQUE7QUFDQSxLQUZBLENBQUE7QUFHQSxHQUpBOztBQU1BLFNBQUEsR0FBQTtBQUVBLENBOUJBIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbndpbmRvdy5hcHAgPSBhbmd1bGFyLm1vZHVsZSgnTXlBcHAnLCBbJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnLCAnbmdBbmltYXRlJywgJ25nS29va2llcyddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGtvb2tpZXNQcm92aWRlcikge1xuICAgIC8vIFRoaXMgdHVybnMgb2ZmIGhhc2hiYW5nIHVybHMgKC8jYWJvdXQpIGFuZCBjaGFuZ2VzIGl0IHRvIHNvbWV0aGluZyBub3JtYWwgKC9hYm91dClcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAgLy8gSWYgd2UgZ28gdG8gYSBVUkwgdGhhdCB1aS1yb3V0ZXIgZG9lc24ndCBoYXZlIHJlZ2lzdGVyZWQsIGdvIHRvIHRoZSBcIi9cIiB1cmwuXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuICAgIC8vIFRyaWdnZXIgcGFnZSByZWZyZXNoIHdoZW4gYWNjZXNzaW5nIGFuIE9BdXRoIHJvdXRlXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLndoZW4oJy9hdXRoLzpwcm92aWRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH0pO1xuXG4gICAgJGtvb2tpZXNQcm92aWRlci5jb25maWcuanNvbiA9IHRydWU7XG5cbn0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdzdHVkZW50Jywge1xuICAgICAgICB1cmw6ICcvc3R1ZGVudCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnanMvdmlld3Mvc3R1ZGVudC9zdHVkZW50Lmh0bWwnLFxuICAgIH0pO1xufSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FkbWluJywge1xuICAgICAgICB1cmw6ICcvYWRtaW4nLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL3ZpZXdzL2luc3RydWN0b3IvaW5zdHJ1Y3Rvci5odG1sJyxcbiAgICB9KTtcbn0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdzdW1tYXJ5Jywge1xuICAgICAgICB1cmw6ICcvc3VtbWFyeScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnanMvdmlld3Mvc3VtbWFyeS9zdW1tYXJ5Lmh0bWwnLFxuICAgIH0pO1xufSk7XG5cbmFwcC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUpIHtcblxuXHRjb25zb2xlLmxvZyhcInJlYWNoZWQgbG9naW4gY3RybFwiKTtcblx0JHNjb3BlLmxvZ2luU3RhdHVzID0gZnVuY3Rpb24oKXtcblx0XHRjb25zb2xlLmxvZyhcInJlYWNoZWQgbG9naW4gc3RhdHVzXCIpO1xuXHRcdHZhciB0ZW1wID0gJHNjb3BlLmxvZ2luO1xuXHRcdGNvbnNvbGUubG9nKFwidGVtcDogXCIsdGVtcCk7XG5cblx0XHRpZiAodGVtcD09PSdhZG1pbicpe1xuXHRcdFx0JHN0YXRlLmdvKCdhZG1pbicpO1xuXHRcdH1cblx0XHRlbHNlIGlmICh0ZW1wPT09J3N0dWRlbnQnKXtcblx0XHRcdCRzdGF0ZS5nbygnc3R1ZGVudCcpO1xuXHRcdH1cbiAgICAgICAgZWxzZSBpZiAodGVtcD09PSdzdW1tYXJ5Jyl7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3N1bW1hcnknKTtcbiAgICAgICAgfVxuXHR9XG5cbn0pO1xuIiwidmFyIHNvY2tldCA9IGlvKHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pOyIsImFwcC5jb250cm9sbGVyKCdDcmVhdGVQb2xsJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwpIHtcblxuICAkc2NvcGUuc2hvd01vZGFsID0gZnVuY3Rpb24oKSB7XG5cbiAgICAkc2NvcGUub3B0cyA9IHtcbiAgICBiYWNrZHJvcDogdHJ1ZSxcbiAgICBiYWNrZHJvcENsaWNrOiB0cnVlLFxuICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgZGlhbG9nRmFkZTogZmFsc2UsXG4gICAga2V5Ym9hcmQ6IHRydWUsXG4gICAgdGVtcGxhdGVVcmwgOiAnanMvY29tbW9uL2NyZWF0ZVBvbGxNb2RhbC9jcmVhdGVQb2xsTW9kYWwuaHRtbCcsXG4gICAgY29udHJvbGxlciA6IE1vZGFsSW5zdGFuY2VDdHJsLFxuICAgIHJlc29sdmU6IHt9IC8vIGVtcHR5IHN0b3JhZ2VcbiAgICAgIH07XG5cbiAgICAkc2NvcGUub3B0cy5yZXNvbHZlLml0ZW0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGFuZ3VsYXIuY29weSh7cG9sbHM6JHNjb3BlLnBvbGxzfSk7IC8vIHBhc3MgbmFtZSB0byBEaWFsb2dcbiAgICB9XG5cbiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oJHNjb3BlLm9wdHMpO1xuXG4gICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vb24gb2sgYnV0dG9uIHByZXNzXG4gICAgICB9LGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vb24gY2FuY2VsIGJ1dHRvbiBwcmVzc1xuICAgICAgfSlcbiAgfVxuXG59KVxuXG52YXIgTW9kYWxJbnN0YW5jZUN0cmwgPSBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkdWliTW9kYWwsIGl0ZW0sIFBvbGxGYWN0b3J5KSB7XG5cbiAgJHNjb3BlLml0ZW0gPSBpdGVtO1xuXG4gICRzY29wZS5jdXN0b21PcHRpb25zID0gZnVuY3Rpb24ob3B0aW9uKSB7XG4gICAgJHNjb3BlLmN1c3RvbVNob3cgPSAob3B0aW9uID09PSAnY3VzdG9tJylcbiAgfVxuXG4gICRzY29wZS5zdWJtaXRQb2xsID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBwb2xsID0ge31cbiAgICBwb2xsLnF1ZXN0aW9uID0gJHNjb3BlLm5ld1BvbGxcbiAgICBwb2xsLmxlY3R1cmVJZCA9IDFcbiAgICBpZiAoJHNjb3BlLm9wdGlvbj09J2N1c3RvbScpIHBvbGwub3B0aW9ucyA9IFskc2NvcGUuYSwgJHNjb3BlLmIsICRzY29wZS5jLCAkc2NvcGUuZF1cblxuICAgIFBvbGxGYWN0b3J5LmNyZWF0ZVBvbGwocG9sbClcbiAgICAudGhlbigoKSA9PiB7IHJldHVybiBQb2xsRmFjdG9yeS5nZXRBbGxCeUxlY3R1cmVJZCgxKSB9KVxuICAgIC50aGVuKChwb2xscykgPT4geyAkc2NvcGUucG9sbHMgPSBwb2xscyB9KVxuICAgIC50aGVuKCgpID0+IHsgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKSB9KVxuICB9XG5cbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgfVxufVxuIiwiYXBwLmRpcmVjdGl2ZSgnZmVlZGJhY2snLCAoJHN0YXRlLCBGZWVkYmFja0ZhY3RvcnkpID0+IHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHNjb3BlOiB7XG5cbiAgICB9LFxuICAgIHRlbXBsYXRlVXJsOiAnanMvY29tbW9uL2ZlZWRiYWNrL2ZlZWRiYWNrLmh0bWwnLFxuICAgIGxpbms6IChzY29wZSkgPT4ge1xuICAgICAgc2NvcGUuYWRkTWVzc2FnZSA9IGZhbHNlO1xuICAgICAgc2NvcGUucmVqZWN0TWVzc2FnZSA9IGZhbHNlO1xuXG4gICAgICBzY29wZS5jb3VudEZlZWRiYWNrID0gZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgIGlmICgoY2F0ZWdvcnkgPT09ICdHcmVhdCcgJiYgIXNjb3BlLmdyZWF0Q291bnQpIHx8IChjYXRlZ29yeSA9PT0gJ0NvbmZ1c2VkJyAmJiAhc2NvcGUuY29uZnVzZWRDb3VudCkgfHwgKGNhdGVnb3J5ID09PSAnRXhhbXBsZScgJiYgIXNjb3BlLmV4YW1wbGVDb3VudCkgfHwgKGNhdGVnb3J5ID09PSAnQ2Fubm90IFNlZScgJiYgIXNjb3BlLnNlZUNvdW50KSB8fCAoY2F0ZWdvcnkgPT09ICdDYW5ub3QgSGVhcicgJiYgIXNjb3BlLmhlYXJDb3VudCkgfHwgKGNhdGVnb3J5ID09PSAnUmVxdWVzdCBCcmVhaycgJiYgIXNjb3BlLmJyZWFrQ291bnQpKSB7XG4gICAgICAgIHJldHVybiBGZWVkYmFja0ZhY3RvcnkuYWRkRmVlZGJhY2soY2F0ZWdvcnkpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gRmVlZGJhY2tGYWN0b3J5LmNvdW50RmVlZGJhY2soY2F0ZWdvcnkpXG4gICAgICAgIH0pIFxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgc29ja2V0LmVtaXQoJ3N1Ym1pdHRlZEZlZWRiYWNrJywgY2F0ZWdvcnkpXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ0lUIElTIEhFUkUnLCByZXN1bHQpXG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnR3JlYXQnKSB7XG4gICAgICAgICAgICBzY29wZS5ncmVhdENvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0NvbmZ1c2VkJykge1xuICAgICAgICAgICAgc2NvcGUuY29uZnVzZWRDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdFeGFtcGxlJykge1xuICAgICAgICAgICAgc2NvcGUuZXhhbXBsZUNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0Nhbm5vdCBTZWUnKSB7XG4gICAgICAgICAgICBzY29wZS5zZWVDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdDYW5ub3QgSGVhcicpIHtcbiAgICAgICAgICAgIHNjb3BlLmhlYXJDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdSZXF1ZXN0IEJyZWFrJykge1xuICAgICAgICAgICAgc2NvcGUuYnJlYWtDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNjb3BlLmFkZE1lc3NhZ2UgPSB0cnVlXG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2NvcGUuYWRkTWVzc2FnZSA9IGZhbHNlO1xuICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgIH0sIDE1MDApO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNjb3BlLmdyZWF0Q291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuY29uZnVzZWRDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5leGFtcGxlQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuc2VlQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuaGVhckNvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLmJyZWFrQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgIH0sIDMwKjEwMDApXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIGVsc2Uge1xuICAgICAgICBzY29wZS5yZWplY3RNZXNzYWdlID0gdHJ1ZVxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2NvcGUucmVqZWN0TWVzc2FnZSA9IGZhbHNlO1xuICAgICAgICAgIHNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgfSwgMTUwMCk7ICAgICAgICBcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzb2NrZXQub24oJ3VwZGF0ZUZlZWRiYWNrJywgZnVuY3Rpb24oY2F0ZWdvcnkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlY2VpdmVkIC0tPicsIGNhdGVnb3J5KVxuXG4gICAgICAgIHJldHVybiBGZWVkYmFja0ZhY3RvcnkuY291bnRGZWVkYmFjayhjYXRlZ29yeSkgXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsgICAgICAgICAgXG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnR3JlYXQnKSB7XG4gICAgICAgICAgICBzY29wZS5ncmVhdENvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0NvbmZ1c2VkJykge1xuICAgICAgICAgICAgc2NvcGUuY29uZnVzZWRDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdFeGFtcGxlJykge1xuICAgICAgICAgICAgc2NvcGUuZXhhbXBsZUNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0Nhbm5vdCBTZWUnKSB7XG4gICAgICAgICAgICBzY29wZS5zZWVDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdDYW5ub3QgSGVhcicpIHtcbiAgICAgICAgICAgIHNjb3BlLmhlYXJDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdSZXF1ZXN0IEJyZWFrJykge1xuICAgICAgICAgICAgc2NvcGUuYnJlYWtDb3VudCA9IHJlc3VsdFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzY29wZS5ncmVhdENvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLmNvbmZ1c2VkQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuZXhhbXBsZUNvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLnNlZUNvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLmhlYXJDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5icmVha0NvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICB9LCAzMCoxMDAwKVxuICAgICAgICB9KVxuICAgICAgICAvLyBzY29wZS4kZGlnZXN0KClcbiAgICB9KVxuXG4gIH1cbn1cbn0pXG4iLCJhcHAuZmFjdG9yeSgnRmVlZGJhY2tGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwKSB7XG5cdHZhciBGZWVkYmFja0ZhY3RvcnkgPSB7fTtcblxuXHRGZWVkYmFja0ZhY3RvcnkuYWRkRmVlZGJhY2sgPSBmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9mZWVkYmFjay8nLCB7Y2F0ZWdvcnk6IGNhdGVnb3J5fSlcblx0XHQudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdnb3RIRVJFJywgcmVzdWx0KVxuXHRcdH0pXG5cdH1cblxuXHRGZWVkYmFja0ZhY3RvcnkuY291bnRGZWVkYmFjayA9IGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvZmVlZGJhY2svY291bnQvJysgY2F0ZWdvcnkpXG5cdFx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0ICkge1xuXHRcdFx0cmV0dXJuIHJlc3VsdC5kYXRhXG5cdFx0fSlcblx0fVxuXG5cdHJldHVybiBGZWVkYmFja0ZhY3Rvcnlcbn0pIiwiYXBwLmRpcmVjdGl2ZSgncG9sbCcsICgkc3RhdGUsIFBvbGxGYWN0b3J5KSA9PiB7XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICBzY29wZToge1xuICAgICAgdXNlQ3RybDogXCJAXCJcbiAgICB9LFxuICAgIHRlbXBsYXRlVXJsOiAnanMvY29tbW9uL3BvbGwvcG9sbC5odG1sJyxcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSkge1xuXG4gICAgICBzY29wZS5kZWxldGUgPSBQb2xsRmFjdG9yeS5kZWxldGVQb2xsXG5cbiAgICAgIFBvbGxGYWN0b3J5LmdldEFsbEJ5TGVjdHVyZUlkKDEpXG4gICAgICAudGhlbigoY3VycmVudFBvbGxzKSA9PiB7XG4gICAgICAgIHNjb3BlLnBvbGxzID0gY3VycmVudFBvbGxzXG4gICAgICB9KVxuXG4gICAgICBzY29wZS5zZW5kUG9sbCA9IGZ1bmN0aW9uKHBvbGwpIHtcbiAgICAgICAgc29ja2V0LmVtaXQoJ3BvbGxPdXQnLCBwb2xsKVxuICAgICAgfVxuXG4gICAgfVxuICB9XG59KVxuIiwiYXBwLmZhY3RvcnkoJ1BvbGxGYWN0b3J5JywgKCRodHRwKSA9PiB7XG4gIGZ1bmN0aW9uIGRvdERhdGEoZG90KSB7XG4gICAgcmV0dXJuIGRvdC5kYXRhXG4gIH1cbiAgdmFyIGNhY2hlZFBvbGxzID0gW11cbiAgcmV0dXJuIHtcbiAgICBnZXRBbGxCeUxlY3R1cmVJZDogKGlkKSA9PiB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3BvbGwvbGVjdHVyZS8nK2lkKVxuICAgICAgLnRoZW4oZG90RGF0YSlcbiAgICAgIC50aGVuKChwb2xscykgPT4ge1xuICAgICAgICBhbmd1bGFyLmNvcHkocG9sbHMsIGNhY2hlZFBvbGxzKVxuICAgICAgICByZXR1cm4gY2FjaGVkUG9sbHNcbiAgICAgIH0pXG4gICAgfSxcbiAgICBnZXRPbmVCeVBvbGxJZDogKGlkKSA9PiB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3BvbGwvJytpZClcbiAgICAgIC50aGVuKGRvdERhdGEpXG4gICAgfSxcbiAgICBjcmVhdGVQb2xsOiAocG9sbE9iaikgPT4ge1xuICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9sbC8nLCBwb2xsT2JqKVxuICAgICAgLnRoZW4oZG90RGF0YSlcbiAgICB9LFxuICAgIHVwZGF0ZVBvbGw6IChwb2xsT2JqLCBpZCkgPT4ge1xuICAgICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS9wb2xsLycraWQsIHBvbGxPYmopXG4gICAgICAudGhlbihkb3REYXRhKVxuICAgIH0sXG4gICAgZGVsZXRlUG9sbDogKGlkKSA9PiB7XG4gICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL3BvbGwvJytpZClcbiAgICAgIC50aGVuKGRvdERhdGEpXG4gICAgICAudGhlbigocmVtb3ZlZFBvbGwpID0+IHtcbiAgICAgICAgY2FjaGVkUG9sbHMuc3BsaWNlKGNhY2hlZFBvbGxzLm1hcChmdW5jdGlvbihpdGVtKSB7IHJldHVybiBpdGVtLmlkIH0pLmluZGV4T2YoaWQpLDEpXG4gICAgICAgIHJldHVybiBjYWNoZWRQb2xsc1xuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pXG4iLCJhcHAuY29udHJvbGxlcignU3R1ZGVudFBvbGwnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCkge1xuICAkc2NvcGUuc2hvd01vZGFsID0gZnVuY3Rpb24oKSB7XG5cbiAgICAkc2NvcGUub3B0cyA9IHtcbiAgICAgIGJhY2tkcm9wOiB0cnVlLFxuICAgICAgYmFja2Ryb3BDbGljazogdHJ1ZSxcbiAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICBkaWFsb2dGYWRlOiBmYWxzZSxcbiAgICAgIGtleWJvYXJkOiB0cnVlLFxuICAgICAgdGVtcGxhdGVVcmwgOiAnanMvY29tbW9uL3N0dWRlbnRNb2RhbC9zdHVkZW50UG9sbC5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXIgOiBTdHVkZW50TW9kYWxJbnN0YW5jZSxcbiAgICAgIHJlc29sdmU6IHt9IC8vIGVtcHR5IHN0b3JhZ2VcbiAgICB9O1xuXG4gICAgJHNjb3BlLm9wdHMucmVzb2x2ZS5pdGVtID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYW5ndWxhci5jb3B5KHtwb2xsOiRzY29wZS5wb2xsfSk7IC8vIHBhc3MgbmFtZSB0byBEaWFsb2dcbiAgICB9XG5cbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKCRzY29wZS5vcHRzKTtcblxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgIC8vb24gb2sgYnV0dG9uIHByZXNzXG4gICAgfSxmdW5jdGlvbigpe1xuICAgICAgLy9vbiBjYW5jZWwgYnV0dG9uIHByZXNzXG4gICAgfSlcbiAgfVxuXG4gIHNvY2tldC5vbigndG9TdHVkZW50JywgZnVuY3Rpb24ocG9sbFF1ZXN0aW9uKSB7XG4gICAgJHNjb3BlLnBvbGwgPSBwb2xsUXVlc3Rpb25cbiAgICAkc2NvcGUuc2hvd01vZGFsKClcbiAgfSlcblxufSlcblxuZnVuY3Rpb24gU3R1ZGVudE1vZGFsSW5zdGFuY2UoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJHVpYk1vZGFsLCBpdGVtLCBQb2xsRmFjdG9yeSkge1xuXG4gICRzY29wZS5pdGVtID0gaXRlbTtcblxuICBzb2NrZXQub24oJ3RvU3R1ZGVudCcsIGZ1bmN0aW9uKHBvbGxRdWVzdGlvbikge1xuICAgICRzY29wZS5wb2xsID0gcG9sbFF1ZXN0aW9uXG4gIH0pXG5cbiAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpXG4gIH1cblxufVxuIiwiYXBwLmRpcmVjdGl2ZSgncXVlc3Rpb24nLCBmdW5jdGlvbigkc3RhdGUsIFF1ZXN0aW9uRmFjdG9yeSkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL2NvbW1vbi9xdWVzdGlvbi9xdWVzdGlvbi5odG1sJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUpIHtcblxuICAgICAgICAgICAgUXVlc3Rpb25GYWN0b3J5LmdldEFsbEJ5TGVjdHVyZUlkKDEpLnRoZW4oZnVuY3Rpb24ocXVlc3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zID0gcXVlc3Rpb25zLmZpbHRlcihmdW5jdGlvbihxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxLnN0YXR1cyA9PT0gJ29wZW4nXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmRJbmRleChxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcGUucXVlc3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5xdWVzdGlvbnNbaV0udGV4dCA9PT0gcXVlc3Rpb24udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlKHF1ZXN0aW9uLCBuKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCtuID4gLTEgJiYgaW5kZXgrbiA8IHNjb3BlLnF1ZXN0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zLnNwbGljZShpbmRleCtuLCAwLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uZXdRdWVzdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSB7dGV4dDogc2NvcGUubmV3UXVlc3Rpb24sIHN1Ym1pdFRpbWU6IERhdGUubm93KCksIHVwdm90ZXM6IDB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBRdWVzdGlvbkZhY3Rvcnkuc3RvcmUocXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24ocSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2FkZGluZ1F1ZXN0aW9uJywgcSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ld1F1ZXN0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2RlbGV0aW5nUXVlc3Rpb24nLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gUXVlc3Rpb25GYWN0b3J5LmRlbGV0ZShxdWVzdGlvbilcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnN0YXR1cyA9ICdjbG9zZWQnXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2RlbGV0aW5nUXVlc3Rpb24nLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS5tb3ZlID0gZnVuY3Rpb24ocXVlc3Rpb24sIG4pIHtcbiAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnbW92ZScsIHF1ZXN0aW9uLCBuKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS51cHZvdGUgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmhhc1Vwdm90ZWQgPSAhcXVlc3Rpb24uaGFzVXB2b3RlZDtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi51cHZvdGVzKys7XG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3Vwdm90aW5nJywgcXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmRvd252b3RlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi5oYXNVcHZvdGVkID0gIXF1ZXN0aW9uLmhhc1Vwdm90ZWQ7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb24udXB2b3Rlcy0tO1xuICAgICAgICAgICAgICAgIHNvY2tldC5lbWl0KCdkb3dudm90aW5nJywgcXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNvY2tldC5vbignYWRkUXVlc3Rpb24nLCBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHNjb3BlLnF1ZXN0aW9ucy51bnNoaWZ0KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgc29ja2V0Lm9uKCdkZWxldGVRdWVzdGlvbicsIGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIHNjb3BlLnF1ZXN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICAgICAgc2NvcGUuJGV2YWxBc3luYygpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBzb2NrZXQub24oJ3JlY2VpdmVkVXB2b3RlJywgZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgocXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gc2NvcGUucXVlc3Rpb25zW2luZGV4XVxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnVwdm90ZXMrK1xuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgc29ja2V0Lm9uKCdyZWNlaXZlZERvd252b3RlJywgZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgocXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gc2NvcGUucXVlc3Rpb25zW2luZGV4XVxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnVwdm90ZXMtLTtcbiAgICAgICAgICAgICAgICBzY29wZS4kZXZhbEFzeW5jKClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHNvY2tldC5vbignbW92aW5nJywgZnVuY3Rpb24ocXVlc3Rpb24sIG4pIHtcbiAgICAgICAgICAgICAgICBtb3ZlKHF1ZXN0aW9uLCBuKVxuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ1F1ZXN0aW9uRmFjdG9yeScsIGZ1bmN0aW9uICgkaHR0cCkge1xuXG5cdHZhciBvYmogPSB7fTtcblxuXHRvYmouZ2V0QWxsQnlMZWN0dXJlSWQgPSBmdW5jdGlvbihsZWN0dXJlSWQpIHtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3F1ZXN0aW9uL2xlY3R1cmUvJyArIGxlY3R1cmVJZCkudGhlbihmdW5jdGlvbihyZXMpIHtcblx0XHRcdHJldHVybiByZXMuZGF0YTtcblx0XHR9KVxuXHR9XG5cblx0b2JqLnN0b3JlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbicsIHF1ZXN0aW9uKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xuXHRcdH0pXG5cdH1cblxuXHRvYmoudXBkYXRlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcblx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL3F1ZXN0aW9uLycgKyBxdWVzdGlvbi5pZCwgcXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG5cdFx0XHRyZXR1cm4gcmVzLmRhdGE7XG5cdFx0fSlcblx0fVxuXG5cdG9iai5kZWxldGUgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuXHRcdHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvcXVlc3Rpb24vJyArIHF1ZXN0aW9uLmlkKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xuXHRcdH0pXG5cdH1cblxuXHRyZXR1cm4gb2JqO1xuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
