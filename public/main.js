'use strict';

window.app = angular.module('MyApp', ['ui.router', 'ui.bootstrap', 'ngAnimate', 'ngKookies']);

app.config(function ($urlRouterProvider, $locationProvider, $kookiesProvider) {
  // This turns off hashbang urls (/#about) and changes it to something normal (/about)
  $locationProvider.html5Mode(true);
  // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
  $urlRouterProvider.otherwise('/');
  // Trigger page refresh when accessing an OAuth route
  $urlRouterProvider.when('/auth/:provider', function () {
    window.location.reload();
  });

  $kookiesProvider.config.json = true;
});

app.config(function ($stateProvider) {
  $stateProvider.state('student', {
    url: '/student',
    templateUrl: 'js/views/student/student.html'
  });
});

app.config(function ($stateProvider) {
  $stateProvider.state('admin', {
    url: '/admin',
    templateUrl: 'js/views/instructor/instructor.html'
  });
});

app.config(function ($stateProvider) {
  $stateProvider.state('summary', {
    url: '/summary',
    templateUrl: 'js/views/summary/summary.html'
  });
});

app.controller('LoginCtrl', function ($scope, $state) {

  console.log("reached login ctrl");
  $scope.loginStatus = function () {
    console.log("reached login status");
    var temp = $scope.login;
    console.log("temp: ", temp);

    if (temp === 'admin') {
      $state.go('admin');
    } else if (temp === 'student') {
      $state.go('student');
    } else if (temp === 'summary') {
      $state.go('summary');
    }
  };
});

var socket = io(window.location.origin);
app.controller('CreatePoll', function ($scope, $uibModal) {

  $scope.showModal = function () {

    $scope.opts = {
      backdrop: true,
      backdropClick: true,
      transclude: true,
      dialogFade: false,
      keyboard: true,
      templateUrl: 'js/common/createPollModal/createPollModal.html',
      controller: ModalInstanceCtrl,
      resolve: {} // empty storage
    };

    $scope.opts.resolve.item = function () {
      return angular.copy({ polls: $scope.polls }); // pass name to Dialog
    };

    var modalInstance = $uibModal.open($scope.opts);

    modalInstance.result.then(function () {
      //on ok button press
    }, function () {
      //on cancel button press
      console.log("Modal Closed");
    });
  };
});

var ModalInstanceCtrl = function ModalInstanceCtrl($scope, $uibModalInstance, $uibModal, item, PollFactory) {

  $scope.item = item;

  $scope.customOptions = function (option) {
    $scope.customShow = option === 'custom';
  };

  $scope.submitPoll = function () {
    var poll = {};
    poll.question = $scope.newPoll;
    poll.lectureId = 1;
    if ($scope.option == 'custom') poll.options = [$scope.a, $scope.b, $scope.c, $scope.d];

    PollFactory.createPoll(poll).then(function () {
      return PollFactory.getAllByLectureId(1);
    }).then(function (polls) {
      $scope.polls = polls;
    }).then(function () {
      $uibModalInstance.close();
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
};

app.directive('feedback', function ($state, FeedbackFactory) {
  return {
    restrict: 'E',
    scope: {},
    templateUrl: 'js/common/feedback/feedback.html',
    link: function link(scope) {
      scope.addMessage = false;
      scope.rejectMessage = false;

      scope.countFeedback = function (category) {
        if (category === 'Great' && !scope.greatCount || category === 'Confused' && !scope.confusedCount || category === 'Example' && !scope.exampleCount || category === 'Cannot See' && !scope.seeCount || category === 'Cannot Hear' && !scope.hearCount || category === 'Request Break' && !scope.breakCount) {
          return FeedbackFactory.addFeedback(category).then(function () {
            return FeedbackFactory.countFeedback(category);
          }).then(function (result) {
            socket.emit('submittedFeedback', category);

            console.log('IT IS HERE', result);
            if (category === 'Great') {
              scope.greatCount = result;
            }
            if (category === 'Confused') {
              scope.confusedCount = result;
            }
            if (category === 'Example') {
              scope.exampleCount = result;
            }
            if (category === 'Cannot See') {
              scope.seeCount = result;
            }
            if (category === 'Cannot Hear') {
              scope.hearCount = result;
            }
            if (category === 'Request Break') {
              scope.breakCount = result;
            }
          }).then(function () {
            scope.addMessage = true;
            setTimeout(function () {
              scope.addMessage = false;
              scope.$digest();
            }, 1500);
          }).then(function () {
            setTimeout(function () {
              scope.greatCount = null;
              scope.confusedCount = null;
              scope.exampleCount = null;
              scope.seeCount = null;
              scope.hearCount = null;
              scope.breakCount = null;
              scope.$digest();
            }, 30 * 1000);
          });
        } else {
          scope.rejectMessage = true;
          setTimeout(function () {
            scope.rejectMessage = false;
            scope.$digest();
          }, 1500);
        }
      };

      socket.on('updateFeedback', function (category) {
        console.log('received -->', category);

        return FeedbackFactory.countFeedback(category).then(function (result) {
          if (category === 'Great') {
            scope.greatCount = result;
          }
          if (category === 'Confused') {
            scope.confusedCount = result;
          }
          if (category === 'Example') {
            scope.exampleCount = result;
          }
          if (category === 'Cannot See') {
            scope.seeCount = result;
          }
          if (category === 'Cannot Hear') {
            scope.hearCount = result;
          }
          if (category === 'Request Break') {
            scope.breakCount = result;
          }
        }).then(function () {
          setTimeout(function () {
            scope.greatCount = null;
            scope.confusedCount = null;
            scope.exampleCount = null;
            scope.seeCount = null;
            scope.hearCount = null;
            scope.breakCount = null;
            scope.$digest();
          }, 30 * 1000);
        });
        // scope.$digest()
      });
    }
  };
});

app.factory('FeedbackFactory', function ($http) {
  var FeedbackFactory = {};

  FeedbackFactory.addFeedback = function (category) {
    return $http.post('/api/feedback/', { category: category }).then(function (result) {
      console.log('gotHERE', result);
    });
  };

  FeedbackFactory.countFeedback = function (category) {
    return $http.get('/api/feedback/count/' + category).then(function (result) {
      return result.data;
    });
  };

  return FeedbackFactory;
});
app.directive('poll', function ($state, PollFactory) {
  return {
    restrict: 'E',
    scope: {
      useCtrl: "@"
    },
    templateUrl: 'js/common/poll/poll.html',
    link: function link(scope) {

      scope.delete = PollFactory.deletePoll;

      PollFactory.getAllByLectureId(1).then(function (currentPolls) {
        scope.polls = currentPolls;
      });
    }
  };
});

app.factory('PollFactory', function ($http) {
  function dotData(dot) {
    return dot.data;
  }
  var cachedPolls = [];
  return {
    getAllByLectureId: function getAllByLectureId(id) {
      return $http.get('/api/poll/lecture/' + id).then(dotData).then(function (polls) {
        angular.copy(polls, cachedPolls);
        return cachedPolls;
      });
    },
    getOneByPollId: function getOneByPollId(id) {
      return $http.get('/api/poll/' + id).then(dotData);
    },
    createPoll: function createPoll(pollObj) {
      return $http.post('/api/poll/', pollObj).then(dotData);
    },
    updatePoll: function updatePoll(pollObj, id) {
      return $http.put('/api/poll/' + id, pollObj).then(dotData);
    },
    deletePoll: function deletePoll(id) {
      return $http.delete('/api/poll/' + id).then(dotData).then(function (removedPoll) {
        cachedPolls.splice(cachedPolls.map(function (item) {
          return item.id;
        }).indexOf(id), 1);
        return cachedPolls;
      });
    }
  };
});

app.directive('question', function ($state, QuestionFactory) {

  return {
    restrict: 'E',
    scope: {},
    templateUrl: 'js/common/question/question.html',
    link: function link(scope) {

      QuestionFactory.getAllByLectureId(1).then(function (questions) {
        scope.questions = questions.filter(function (q) {
          return q.status === 'open';
        });
      });

      function findIndex(question) {
        for (var i = 0; i < scope.questions.length; i++) {
          if (scope.questions[i].text === question.text) {
            return i;
          }
        }
        return -1;
      }

      function move(question, n) {
        var index = findIndex(question);
        if (index + n > -1 && index + n < scope.questions.length) {
          scope.questions.splice(index, 1);
          scope.questions.splice(index + n, 0, question);
        }
      }

      scope.submit = function () {
        if (scope.newQuestion) {
          var question = { text: scope.newQuestion, submitTime: Date.now(), upvotes: 0 };
          return QuestionFactory.store(question).then(function (q) {
            socket.emit('addingQuestion', q);
            scope.newQuestion = null;
          });
        }
      };

      scope.delete = function (question) {
        socket.emit('deletingQuestion', question);
        return QuestionFactory.delete(question);
      };

      scope.close = function (question) {
        question.status = 'closed';
        return QuestionFactory.update(question).then(function () {
          socket.emit('deletingQuestion', question);
        });
      };

      scope.move = function (question, n) {
        socket.emit('move', question, n);
      };

      scope.upvote = function (question) {
        question.hasUpvoted = !question.hasUpvoted;
        question.upvotes++;
        socket.emit('upvoting', question);
        return QuestionFactory.update(question);
      };

      scope.downvote = function (question) {
        question.hasUpvoted = !question.hasUpvoted;
        question.upvotes--;
        socket.emit('downvoting', question);
        return QuestionFactory.update(question);
      };

      socket.on('addQuestion', function (question) {
        scope.questions.unshift(question);
        scope.$evalAsync();
      });

      socket.on('deleteQuestion', function (question) {
        var index = findIndex(question);
        scope.questions.splice(index, 1);
        scope.$evalAsync();
      });

      socket.on('receivedUpvote', function (question) {
        var index = findIndex(question);
        var question = scope.questions[index];
        question.upvotes++;
        scope.$evalAsync();
      });

      socket.on('receivedDownvote', function (question) {
        var index = findIndex(question);
        var question = scope.questions[index];
        question.upvotes--;
        scope.$evalAsync();
      });

      socket.on('moving', function (question, n) {
        move(question, n);
        scope.$evalAsync();
      });
    }
  };
});

app.factory('QuestionFactory', function ($http) {

  var obj = {};

  obj.getAllByLectureId = function (lectureId) {
    return $http.get('/api/question/lecture/' + lectureId).then(function (res) {
      return res.data;
    });
  };

  obj.store = function (question) {
    return $http.post('/api/question', question).then(function (res) {
      return res.data;
    });
  };

  obj.update = function (question) {
    return $http.put('/api/question/' + question.id, question).then(function (res) {
      return res.data;
    });
  };

  obj.delete = function (question) {
    return $http.delete('/api/question/' + question.id).then(function (res) {
      return res.data;
    });
  };

  return obj;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNvY2tldC5qcyIsImNvbW1vbi9jcmVhdGVQb2xsTW9kYWwvY3JlYXRlUG9sbC5jb250cm9sbGVyLmpzIiwiY29tbW9uL2ZlZWRiYWNrL2ZlZWRiYWNrLmRpcmVjdGl2ZS5qcyIsImNvbW1vbi9mZWVkYmFjay9mZWVkYmFjay5mYWN0b3J5LmpzIiwiY29tbW9uL3BvbGwvcG9sbC5kaXJlY3RpdmUuanMiLCJjb21tb24vcG9sbC9wb2xsLmZhY3RvcnkuanMiLCJjb21tb24vcXVlc3Rpb24vcXVlc3Rpb24uZGlyZWN0aXZlLmpzIiwiY29tbW9uL3F1ZXN0aW9uL3F1ZXN0aW9uLmZhY3RvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsT0FBQSxHQUFBLEdBQUEsUUFBQSxNQUFBLENBQUEsT0FBQSxFQUFBLENBQUEsV0FBQSxFQUFBLGNBQUEsRUFBQSxXQUFBLEVBQUEsV0FBQSxDQUFBLENBQUE7O0FBRUEsSUFBQSxNQUFBLENBQUEsVUFBQSxrQkFBQSxFQUFBLGlCQUFBLEVBQUEsZ0JBQUEsRUFBQTs7QUFFQSxvQkFBQSxTQUFBLENBQUEsSUFBQTs7QUFFQSxxQkFBQSxTQUFBLENBQUEsR0FBQTs7QUFFQSxxQkFBQSxJQUFBLENBQUEsaUJBQUEsRUFBQSxZQUFBO0FBQ0EsV0FBQSxRQUFBLENBQUEsTUFBQTtBQUNBLEdBRkE7O0FBSUEsbUJBQUEsTUFBQSxDQUFBLElBQUEsR0FBQSxJQUFBO0FBRUEsQ0FaQTs7QUFjQSxJQUFBLE1BQUEsQ0FBQSxVQUFBLGNBQUEsRUFBQTtBQUNBLGlCQUFBLEtBQUEsQ0FBQSxTQUFBLEVBQUE7QUFDQSxTQUFBLFVBREE7QUFFQSxpQkFBQTtBQUZBLEdBQUE7QUFJQSxDQUxBOztBQU9BLElBQUEsTUFBQSxDQUFBLFVBQUEsY0FBQSxFQUFBO0FBQ0EsaUJBQUEsS0FBQSxDQUFBLE9BQUEsRUFBQTtBQUNBLFNBQUEsUUFEQTtBQUVBLGlCQUFBO0FBRkEsR0FBQTtBQUlBLENBTEE7O0FBT0EsSUFBQSxNQUFBLENBQUEsVUFBQSxjQUFBLEVBQUE7QUFDQSxpQkFBQSxLQUFBLENBQUEsU0FBQSxFQUFBO0FBQ0EsU0FBQSxVQURBO0FBRUEsaUJBQUE7QUFGQSxHQUFBO0FBSUEsQ0FMQTs7QUFPQSxJQUFBLFVBQUEsQ0FBQSxXQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsTUFBQSxFQUFBOztBQUVBLFVBQUEsR0FBQSxDQUFBLG9CQUFBO0FBQ0EsU0FBQSxXQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsR0FBQSxDQUFBLHNCQUFBO0FBQ0EsUUFBQSxPQUFBLE9BQUEsS0FBQTtBQUNBLFlBQUEsR0FBQSxDQUFBLFFBQUEsRUFBQSxJQUFBOztBQUVBLFFBQUEsU0FBQSxPQUFBLEVBQUE7QUFDQSxhQUFBLEVBQUEsQ0FBQSxPQUFBO0FBQ0EsS0FGQSxNQUdBLElBQUEsU0FBQSxTQUFBLEVBQUE7QUFDQSxhQUFBLEVBQUEsQ0FBQSxTQUFBO0FBQ0EsS0FGQSxNQUdBLElBQUEsU0FBQSxTQUFBLEVBQUE7QUFDQSxhQUFBLEVBQUEsQ0FBQSxTQUFBO0FBQ0E7QUFDQSxHQWRBO0FBZ0JBLENBbkJBOztBQ3ZDQSxJQUFBLFNBQUEsR0FBQSxPQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUE7QUNBQSxJQUFBLFVBQUEsQ0FBQSxZQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsU0FBQSxFQUFBOztBQUVBLFNBQUEsU0FBQSxHQUFBLFlBQUE7O0FBRUEsV0FBQSxJQUFBLEdBQUE7QUFDQSxnQkFBQSxJQURBO0FBRUEscUJBQUEsSUFGQTtBQUdBLGtCQUFBLElBSEE7QUFJQSxrQkFBQSxLQUpBO0FBS0EsZ0JBQUEsSUFMQTtBQU1BLG1CQUFBLGdEQU5BO0FBT0Esa0JBQUEsaUJBUEE7QUFRQSxlQUFBLEU7QUFSQSxLQUFBOztBQVdBLFdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLEdBQUEsWUFBQTtBQUNBLGFBQUEsUUFBQSxJQUFBLENBQUEsRUFBQSxPQUFBLE9BQUEsS0FBQSxFQUFBLENBQUEsQztBQUNBLEtBRkE7O0FBSUEsUUFBQSxnQkFBQSxVQUFBLElBQUEsQ0FBQSxPQUFBLElBQUEsQ0FBQTs7QUFFQSxrQkFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFlBQUE7O0FBRUEsS0FGQSxFQUVBLFlBQUE7O0FBRUEsY0FBQSxHQUFBLENBQUEsY0FBQTtBQUNBLEtBTEE7QUFNQSxHQXpCQTtBQTJCQSxDQTdCQTs7QUErQkEsSUFBQSxvQkFBQSxTQUFBLGlCQUFBLENBQUEsTUFBQSxFQUFBLGlCQUFBLEVBQUEsU0FBQSxFQUFBLElBQUEsRUFBQSxXQUFBLEVBQUE7O0FBRUEsU0FBQSxJQUFBLEdBQUEsSUFBQTs7QUFFQSxTQUFBLGFBQUEsR0FBQSxVQUFBLE1BQUEsRUFBQTtBQUNBLFdBQUEsVUFBQSxHQUFBLFdBQUEsUUFBQTtBQUNBLEdBRkE7O0FBSUEsU0FBQSxVQUFBLEdBQUEsWUFBQTtBQUNBLFFBQUEsT0FBQSxFQUFBO0FBQ0EsU0FBQSxRQUFBLEdBQUEsT0FBQSxPQUFBO0FBQ0EsU0FBQSxTQUFBLEdBQUEsQ0FBQTtBQUNBLFFBQUEsT0FBQSxNQUFBLElBQUEsUUFBQSxFQUFBLEtBQUEsT0FBQSxHQUFBLENBQUEsT0FBQSxDQUFBLEVBQUEsT0FBQSxDQUFBLEVBQUEsT0FBQSxDQUFBLEVBQUEsT0FBQSxDQUFBLENBQUE7O0FBRUEsZ0JBQUEsVUFBQSxDQUFBLElBQUEsRUFDQSxJQURBLENBQ0EsWUFBQTtBQUFBLGFBQUEsWUFBQSxpQkFBQSxDQUFBLENBQUEsQ0FBQTtBQUFBLEtBREEsRUFFQSxJQUZBLENBRUEsVUFBQSxLQUFBLEVBQUE7QUFBQSxhQUFBLEtBQUEsR0FBQSxLQUFBO0FBQUEsS0FGQSxFQUdBLElBSEEsQ0FHQSxZQUFBO0FBQUEsd0JBQUEsS0FBQTtBQUFBLEtBSEE7QUFJQSxHQVZBOztBQVlBLFNBQUEsTUFBQSxHQUFBLFlBQUE7QUFDQSxzQkFBQSxPQUFBLENBQUEsUUFBQTtBQUNBLEdBRkE7QUFHQSxDQXZCQTs7QUMvQkEsSUFBQSxTQUFBLENBQUEsVUFBQSxFQUFBLFVBQUEsTUFBQSxFQUFB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QUEsRUFDQSxJQURBLENBQ0EsT0FEQSxDQUFBO0FBRUEsS0FwQkE7QUFxQkEsZ0JBQUEsb0JBQUEsRUFBQSxFQUFBO0FBQ0EsYUFBQSxNQUFBLE1BQUEsQ0FBQSxlQUFBLEVBQUEsRUFDQSxJQURBLENBQ0EsT0FEQSxFQUVBLElBRkEsQ0FFQSxVQUFBLFdBQUEsRUFBQTtBQUNBLG9CQUFBLE1BQUEsQ0FBQSxZQUFBLEdBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUFBLGlCQUFBLEtBQUEsRUFBQTtBQUFBLFNBQUEsRUFBQSxPQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQTtBQUNBLGVBQUEsV0FBQTtBQUNBLE9BTEEsQ0FBQTtBQU1BO0FBNUJBLEdBQUE7QUE4QkEsQ0FuQ0E7O0FDQUEsSUFBQSxTQUFBLENBQUEsVUFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLGVBQUEsRUFBQTs7QUFFQSxTQUFBO0FBQ0EsY0FBQSxHQURBO0FBRUEsV0FBQSxFQUZBO0FBS0EsaUJBQUEsa0NBTEE7QUFNQSxVQUFBLGNBQUEsS0FBQSxFQUFBOztBQUVBLHNCQUFBLGlCQUFBLENBQUEsQ0FBQSxFQUFBLElBQUEsQ0FBQSxVQUFBLFNBQUEsRUFBQTtBQUNBLGNBQUEsU0FBQSxHQUFBLFVBQUEsTUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUFBO0FBQ0EsaUJBQUEsRUFBQSxNQUFBLEtBQUEsTUFBQTtBQUNBLFNBRkEsQ0FBQTtBQUdBLE9BSkE7O0FBTUEsZUFBQSxTQUFBLENBQUEsUUFBQSxFQUFBO0FBQ0EsYUFBQSxJQUFBLElBQUEsQ0FBQSxFQUFBLElBQUEsTUFBQSxTQUFBLENBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQTtBQUNBLGNBQUEsTUFBQSxTQUFBLENBQUEsQ0FBQSxFQUFBLElBQUEsS0FBQSxTQUFBLElBQUEsRUFBQTtBQUNBLG1CQUFBLENBQUE7QUFDQTtBQUNBO0FBQ0EsZUFBQSxDQUFBLENBQUE7QUFDQTs7QUFFQSxlQUFBLElBQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQSxFQUFBO0FBQ0EsWUFBQSxRQUFBLFVBQUEsUUFBQSxDQUFBO0FBQ0EsWUFBQSxRQUFBLENBQUEsR0FBQSxDQUFBLENBQUEsSUFBQSxRQUFBLENBQUEsR0FBQSxNQUFBLFNBQUEsQ0FBQSxNQUFBLEVBQUE7QUFDQSxnQkFBQSxTQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0FBQ0EsZ0JBQUEsU0FBQSxDQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsUUFBQTtBQUNBO0FBQ0E7O0FBRUEsWUFBQSxNQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsTUFBQSxXQUFBLEVBQUE7QUFDQSxjQUFBLFdBQUEsRUFBQSxNQUFBLE1BQUEsV0FBQSxFQUFBLFlBQUEsS0FBQSxHQUFBLEVBQUEsRUFBQSxTQUFBLENBQUEsRUFBQTtBQUNBLGlCQUFBLGdCQUFBLEtBQUEsQ0FBQSxRQUFBLEVBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUFBO0FBQ0EsbUJBQUEsSUFBQSxDQUFBLGdCQUFBLEVBQUEsQ0FBQTtBQUNBLGtCQUFBLFdBQUEsR0FBQSxJQUFBO0FBQ0EsV0FIQSxDQUFBO0FBSUE7QUFDQSxPQVJBOztBQVVBLFlBQUEsTUFBQSxHQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsZUFBQSxJQUFBLENBQUEsa0JBQUEsRUFBQSxRQUFBO0FBQ0EsZUFBQSxnQkFBQSxNQUFBLENBQUEsUUFBQSxDQUFBO0FBQ0EsT0FIQTs7QUFLQSxZQUFBLEtBQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLGlCQUFBLE1BQUEsR0FBQSxRQUFBO0FBQ0EsZUFBQSxnQkFBQSxNQUFBLENBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxZQUFBO0FBQ0EsaUJBQUEsSUFBQSxDQUFBLGtCQUFBLEVBQUEsUUFBQTtBQUNBLFNBRkEsQ0FBQTtBQUdBLE9BTEE7O0FBT0EsWUFBQSxJQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUEsQ0FBQSxFQUFBO0FBQ0EsZUFBQSxJQUFBLENBQUEsTUFBQSxFQUFBLFFBQUEsRUFBQSxDQUFBO0FBQ0EsT0FGQTs7QUFJQSxZQUFBLE1BQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLGlCQUFBLFVBQUEsR0FBQSxDQUFBLFNBQUEsVUFBQTtBQUNBLGlCQUFBLE9BQUE7QUFDQSxlQUFBLElBQUEsQ0FBQSxVQUFBLEVBQUEsUUFBQTtBQUNBLGVBQUEsZ0JBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQTtBQUNBLE9BTEE7O0FBT0EsWUFBQSxRQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxpQkFBQSxVQUFBLEdBQUEsQ0FBQSxTQUFBLFVBQUE7QUFDQSxpQkFBQSxPQUFBO0FBQ0EsZUFBQSxJQUFBLENBQUEsWUFBQSxFQUFBLFFBQUE7QUFDQSxlQUFBLGdCQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUE7QUFDQSxPQUxBOztBQU9BLGFBQUEsRUFBQSxDQUFBLGFBQUEsRUFBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLGNBQUEsU0FBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBO0FBQ0EsY0FBQSxVQUFBO0FBQ0EsT0FIQTs7QUFLQSxhQUFBLEVBQUEsQ0FBQSxnQkFBQSxFQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsWUFBQSxRQUFBLFVBQUEsUUFBQSxDQUFBO0FBQ0EsY0FBQSxTQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0FBQ0EsY0FBQSxVQUFBO0FBQ0EsT0FKQTs7QUFNQSxhQUFBLEVBQUEsQ0FBQSxnQkFBQSxFQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsWUFBQSxRQUFBLFVBQUEsUUFBQSxDQUFBO0FBQ0EsWUFBQSxXQUFBLE1BQUEsU0FBQSxDQUFBLEtBQUEsQ0FBQTtBQUNBLGlCQUFBLE9BQUE7QUFDQSxjQUFBLFVBQUE7QUFDQSxPQUxBOztBQU9BLGFBQUEsRUFBQSxDQUFBLGtCQUFBLEVBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxZQUFBLFFBQUEsVUFBQSxRQUFBLENBQUE7QUFDQSxZQUFBLFdBQUEsTUFBQSxTQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0EsaUJBQUEsT0FBQTtBQUNBLGNBQUEsVUFBQTtBQUNBLE9BTEE7O0FBT0EsYUFBQSxFQUFBLENBQUEsUUFBQSxFQUFBLFVBQUEsUUFBQSxFQUFBLENBQUEsRUFBQTtBQUNBLGFBQUEsUUFBQSxFQUFBLENBQUE7QUFDQSxjQUFBLFVBQUE7QUFDQSxPQUhBO0FBSUE7QUFwR0EsR0FBQTtBQXNHQSxDQXhHQTs7QUNBQSxJQUFBLE9BQUEsQ0FBQSxpQkFBQSxFQUFBLFVBQUEsS0FBQSxFQUFBOztBQUVBLE1BQUEsTUFBQSxFQUFBOztBQUVBLE1BQUEsaUJBQUEsR0FBQSxVQUFBLFNBQUEsRUFBQTtBQUNBLFdBQUEsTUFBQSxHQUFBLENBQUEsMkJBQUEsU0FBQSxFQUFBLElBQUEsQ0FBQSxVQUFBLEdBQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxJQUFBO0FBQ0EsS0FGQSxDQUFBO0FBR0EsR0FKQTs7QUFNQSxNQUFBLEtBQUEsR0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLFdBQUEsTUFBQSxJQUFBLENBQUEsZUFBQSxFQUFBLFFBQUEsRUFBQSxJQUFBLENBQUEsVUFBQSxHQUFBLEVBQUE7QUFDQSxhQUFBLElBQUEsSUFBQTtBQUNBLEtBRkEsQ0FBQTtBQUdBLEdBSkE7O0FBTUEsTUFBQSxNQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxXQUFBLE1BQUEsR0FBQSxDQUFBLG1CQUFBLFNBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxJQUFBLENBQUEsVUFBQSxHQUFBLEVBQUE7QUFDQSxhQUFBLElBQUEsSUFBQTtBQUNBLEtBRkEsQ0FBQTtBQUdBLEdBSkE7O0FBTUEsTUFBQSxNQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxXQUFBLE1BQUEsTUFBQSxDQUFBLG1CQUFBLFNBQUEsRUFBQSxFQUFBLElBQUEsQ0FBQSxVQUFBLEdBQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxJQUFBO0FBQ0EsS0FGQSxDQUFBO0FBR0EsR0FKQTs7QUFNQSxTQUFBLEdBQUE7QUFFQSxDQTlCQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cuYXBwID0gYW5ndWxhci5tb2R1bGUoJ015QXBwJywgWyd1aS5yb3V0ZXInLCAndWkuYm9vdHN0cmFwJywgJ25nQW5pbWF0ZScsICduZ0tvb2tpZXMnXSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRrb29raWVzUHJvdmlkZXIpIHtcbiAgICAvLyBUaGlzIHR1cm5zIG9mZiBoYXNoYmFuZyB1cmxzICgvI2Fib3V0KSBhbmQgY2hhbmdlcyBpdCB0byBzb21ldGhpbmcgbm9ybWFsICgvYWJvdXQpXG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuICAgIC8vIElmIHdlIGdvIHRvIGEgVVJMIHRoYXQgdWktcm91dGVyIGRvZXNuJ3QgaGF2ZSByZWdpc3RlcmVkLCBnbyB0byB0aGUgXCIvXCIgdXJsLlxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbiAgICAvLyBUcmlnZ2VyIHBhZ2UgcmVmcmVzaCB3aGVuIGFjY2Vzc2luZyBhbiBPQXV0aCByb3V0ZVxuICAgICR1cmxSb3V0ZXJQcm92aWRlci53aGVuKCcvYXV0aC86cHJvdmlkZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9KTtcblxuICAgICRrb29raWVzUHJvdmlkZXIuY29uZmlnLmpzb24gPSB0cnVlO1xuXG59KTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnc3R1ZGVudCcsIHtcbiAgICAgICAgdXJsOiAnL3N0dWRlbnQnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL3ZpZXdzL3N0dWRlbnQvc3R1ZGVudC5odG1sJyxcbiAgICB9KTtcbn0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdhZG1pbicsIHtcbiAgICAgICAgdXJsOiAnL2FkbWluJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy92aWV3cy9pbnN0cnVjdG9yL2luc3RydWN0b3IuaHRtbCcsXG4gICAgfSk7XG59KTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnc3VtbWFyeScsIHtcbiAgICAgICAgdXJsOiAnL3N1bW1hcnknLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL3ZpZXdzL3N1bW1hcnkvc3VtbWFyeS5odG1sJyxcbiAgICB9KTtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJHN0YXRlKSB7XG5cblx0Y29uc29sZS5sb2coXCJyZWFjaGVkIGxvZ2luIGN0cmxcIik7XG5cdCRzY29wZS5sb2dpblN0YXR1cyA9IGZ1bmN0aW9uKCl7XG5cdFx0Y29uc29sZS5sb2coXCJyZWFjaGVkIGxvZ2luIHN0YXR1c1wiKTtcblx0XHR2YXIgdGVtcCA9ICRzY29wZS5sb2dpbjtcblx0XHRjb25zb2xlLmxvZyhcInRlbXA6IFwiLHRlbXApO1xuXG5cdFx0aWYgKHRlbXA9PT0nYWRtaW4nKXtcblx0XHRcdCRzdGF0ZS5nbygnYWRtaW4nKTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAodGVtcD09PSdzdHVkZW50Jyl7XG5cdFx0XHQkc3RhdGUuZ28oJ3N0dWRlbnQnKTtcblx0XHR9XG4gICAgICAgIGVsc2UgaWYgKHRlbXA9PT0nc3VtbWFyeScpe1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdzdW1tYXJ5Jyk7XG4gICAgICAgIH1cblx0fVxuXG59KTtcbiIsInZhciBzb2NrZXQgPSBpbyh3aW5kb3cubG9jYXRpb24ub3JpZ2luKTsiLCJhcHAuY29udHJvbGxlcignQ3JlYXRlUG9sbCcsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsKSB7XG5cbiAgJHNjb3BlLnNob3dNb2RhbCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgJHNjb3BlLm9wdHMgPSB7XG4gICAgYmFja2Ryb3A6IHRydWUsXG4gICAgYmFja2Ryb3BDbGljazogdHJ1ZSxcbiAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgIGRpYWxvZ0ZhZGU6IGZhbHNlLFxuICAgIGtleWJvYXJkOiB0cnVlLFxuICAgIHRlbXBsYXRlVXJsIDogJ2pzL2NvbW1vbi9jcmVhdGVQb2xsTW9kYWwvY3JlYXRlUG9sbE1vZGFsLmh0bWwnLFxuICAgIGNvbnRyb2xsZXIgOiBNb2RhbEluc3RhbmNlQ3RybCxcbiAgICByZXNvbHZlOiB7fSAvLyBlbXB0eSBzdG9yYWdlXG4gICAgICB9O1xuXG4gICAgJHNjb3BlLm9wdHMucmVzb2x2ZS5pdGVtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBhbmd1bGFyLmNvcHkoe3BvbGxzOiRzY29wZS5wb2xsc30pOyAvLyBwYXNzIG5hbWUgdG8gRGlhbG9nXG4gICAgfVxuXG4gICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKCRzY29wZS5vcHRzKTtcblxuICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAvL29uIG9rIGJ1dHRvbiBwcmVzc1xuICAgICAgfSxmdW5jdGlvbigpe1xuICAgICAgICAvL29uIGNhbmNlbCBidXR0b24gcHJlc3NcbiAgICAgICAgY29uc29sZS5sb2coXCJNb2RhbCBDbG9zZWRcIik7XG4gICAgICB9KVxuICB9XG5cbn0pXG5cbnZhciBNb2RhbEluc3RhbmNlQ3RybCA9IGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICR1aWJNb2RhbCwgaXRlbSwgUG9sbEZhY3RvcnkpIHtcblxuICAkc2NvcGUuaXRlbSA9IGl0ZW07XG5cbiAgJHNjb3BlLmN1c3RvbU9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb24pIHtcbiAgICAkc2NvcGUuY3VzdG9tU2hvdyA9IChvcHRpb24gPT09ICdjdXN0b20nKVxuICB9XG5cbiAgJHNjb3BlLnN1Ym1pdFBvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBvbGwgPSB7fVxuICAgIHBvbGwucXVlc3Rpb24gPSAkc2NvcGUubmV3UG9sbFxuICAgIHBvbGwubGVjdHVyZUlkID0gMVxuICAgIGlmICgkc2NvcGUub3B0aW9uPT0nY3VzdG9tJykgcG9sbC5vcHRpb25zID0gWyRzY29wZS5hLCAkc2NvcGUuYiwgJHNjb3BlLmMsICRzY29wZS5kXVxuXG4gICAgUG9sbEZhY3RvcnkuY3JlYXRlUG9sbChwb2xsKVxuICAgIC50aGVuKCgpID0+IHsgcmV0dXJuIFBvbGxGYWN0b3J5LmdldEFsbEJ5TGVjdHVyZUlkKDEpIH0pXG4gICAgLnRoZW4oKHBvbGxzKSA9PiB7ICRzY29wZS5wb2xscyA9IHBvbGxzIH0pXG4gICAgLnRoZW4oKCkgPT4geyAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpIH0pXG4gIH1cblxuICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICB9XG59XG4iLCJhcHAuZGlyZWN0aXZlKCdmZWVkYmFjaycsICgkc3RhdGUsIEZlZWRiYWNrRmFjdG9yeSkgPT4ge1xuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgc2NvcGU6IHtcblxuICAgIH0sXG4gICAgdGVtcGxhdGVVcmw6ICdqcy9jb21tb24vZmVlZGJhY2svZmVlZGJhY2suaHRtbCcsXG4gICAgbGluazogKHNjb3BlKSA9PiB7XG4gICAgICBzY29wZS5hZGRNZXNzYWdlID0gZmFsc2U7XG4gICAgICBzY29wZS5yZWplY3RNZXNzYWdlID0gZmFsc2U7XG5cbiAgICAgIHNjb3BlLmNvdW50RmVlZGJhY2sgPSBmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgaWYgKChjYXRlZ29yeSA9PT0gJ0dyZWF0JyAmJiAhc2NvcGUuZ3JlYXRDb3VudCkgfHwgKGNhdGVnb3J5ID09PSAnQ29uZnVzZWQnICYmICFzY29wZS5jb25mdXNlZENvdW50KSB8fCAoY2F0ZWdvcnkgPT09ICdFeGFtcGxlJyAmJiAhc2NvcGUuZXhhbXBsZUNvdW50KSB8fCAoY2F0ZWdvcnkgPT09ICdDYW5ub3QgU2VlJyAmJiAhc2NvcGUuc2VlQ291bnQpIHx8IChjYXRlZ29yeSA9PT0gJ0Nhbm5vdCBIZWFyJyAmJiAhc2NvcGUuaGVhckNvdW50KSB8fCAoY2F0ZWdvcnkgPT09ICdSZXF1ZXN0IEJyZWFrJyAmJiAhc2NvcGUuYnJlYWtDb3VudCkpIHtcbiAgICAgICAgcmV0dXJuIEZlZWRiYWNrRmFjdG9yeS5hZGRGZWVkYmFjayhjYXRlZ29yeSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBGZWVkYmFja0ZhY3RvcnkuY291bnRGZWVkYmFjayhjYXRlZ29yeSlcbiAgICAgICAgfSkgXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICBzb2NrZXQuZW1pdCgnc3VibWl0dGVkRmVlZGJhY2snLCBjYXRlZ29yeSlcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZygnSVQgSVMgSEVSRScsIHJlc3VsdClcbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdHcmVhdCcpIHtcbiAgICAgICAgICAgIHNjb3BlLmdyZWF0Q291bnQgPSByZXN1bHRcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnQ29uZnVzZWQnKSB7XG4gICAgICAgICAgICBzY29wZS5jb25mdXNlZENvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0V4YW1wbGUnKSB7XG4gICAgICAgICAgICBzY29wZS5leGFtcGxlQ291bnQgPSByZXN1bHRcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnQ2Fubm90IFNlZScpIHtcbiAgICAgICAgICAgIHNjb3BlLnNlZUNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0Nhbm5vdCBIZWFyJykge1xuICAgICAgICAgICAgc2NvcGUuaGVhckNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ1JlcXVlc3QgQnJlYWsnKSB7XG4gICAgICAgICAgICBzY29wZS5icmVha0NvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2NvcGUuYWRkTWVzc2FnZSA9IHRydWVcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzY29wZS5hZGRNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgfSwgMTUwMCk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2NvcGUuZ3JlYXRDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5jb25mdXNlZENvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLmV4YW1wbGVDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5zZWVDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5oZWFyQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuYnJlYWtDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgfSwgMzAqMTAwMClcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgZWxzZSB7XG4gICAgICAgIHNjb3BlLnJlamVjdE1lc3NhZ2UgPSB0cnVlXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICBzY29wZS5yZWplY3RNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICB9LCAxNTAwKTsgICAgICAgIFxuICAgICAgfVxuICAgIH1cblxuICAgIHNvY2tldC5vbigndXBkYXRlRmVlZGJhY2snLCBmdW5jdGlvbihjYXRlZ29yeSkge1xuICAgICAgICBjb25zb2xlLmxvZygncmVjZWl2ZWQgLS0+JywgY2F0ZWdvcnkpXG5cbiAgICAgICAgcmV0dXJuIEZlZWRiYWNrRmFjdG9yeS5jb3VudEZlZWRiYWNrKGNhdGVnb3J5KSBcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgeyAgICAgICAgICBcbiAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdHcmVhdCcpIHtcbiAgICAgICAgICAgIHNjb3BlLmdyZWF0Q291bnQgPSByZXN1bHRcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnQ29uZnVzZWQnKSB7XG4gICAgICAgICAgICBzY29wZS5jb25mdXNlZENvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0V4YW1wbGUnKSB7XG4gICAgICAgICAgICBzY29wZS5leGFtcGxlQ291bnQgPSByZXN1bHRcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnQ2Fubm90IFNlZScpIHtcbiAgICAgICAgICAgIHNjb3BlLnNlZUNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ0Nhbm5vdCBIZWFyJykge1xuICAgICAgICAgICAgc2NvcGUuaGVhckNvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ1JlcXVlc3QgQnJlYWsnKSB7XG4gICAgICAgICAgICBzY29wZS5icmVha0NvdW50ID0gcmVzdWx0XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNjb3BlLmdyZWF0Q291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuY29uZnVzZWRDb3VudCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5leGFtcGxlQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuc2VlQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuaGVhckNvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLmJyZWFrQ291bnQgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgIH0sIDMwKjEwMDApXG4gICAgICAgIH0pXG4gICAgICAgIC8vIHNjb3BlLiRkaWdlc3QoKVxuICAgIH0pXG5cbiAgfVxufVxufSlcbiIsImFwcC5mYWN0b3J5KCdGZWVkYmFja0ZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHApIHtcblx0dmFyIEZlZWRiYWNrRmFjdG9yeSA9IHt9O1xuXG5cdEZlZWRiYWNrRmFjdG9yeS5hZGRGZWVkYmFjayA9IGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuXHRcdHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2ZlZWRiYWNrLycsIHtjYXRlZ29yeTogY2F0ZWdvcnl9KVxuXHRcdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0Y29uc29sZS5sb2coJ2dvdEhFUkUnLCByZXN1bHQpXG5cdFx0fSlcblx0fVxuXG5cdEZlZWRiYWNrRmFjdG9yeS5jb3VudEZlZWRiYWNrID0gZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG5cdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9mZWVkYmFjay9jb3VudC8nKyBjYXRlZ29yeSlcblx0XHQudGhlbihmdW5jdGlvbihyZXN1bHQgKSB7XG5cdFx0XHRyZXR1cm4gcmVzdWx0LmRhdGFcblx0XHR9KVxuXHR9XG5cblx0cmV0dXJuIEZlZWRiYWNrRmFjdG9yeVxufSkiLCJhcHAuZGlyZWN0aXZlKCdwb2xsJywgKCRzdGF0ZSwgUG9sbEZhY3RvcnkpID0+IHtcbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHNjb3BlOiB7XG4gICAgICB1c2VDdHJsOiBcIkBcIlxuICAgIH0sXG4gICAgdGVtcGxhdGVVcmw6ICdqcy9jb21tb24vcG9sbC9wb2xsLmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlKSB7XG5cbiAgICAgIHNjb3BlLmRlbGV0ZSA9IFBvbGxGYWN0b3J5LmRlbGV0ZVBvbGxcblxuICAgICAgUG9sbEZhY3RvcnkuZ2V0QWxsQnlMZWN0dXJlSWQoMSlcbiAgICAgIC50aGVuKChjdXJyZW50UG9sbHMpID0+IHtcbiAgICAgICAgc2NvcGUucG9sbHMgPSBjdXJyZW50UG9sbHNcbiAgICAgIH0pXG5cblxuICAgIH1cbiAgfVxufSlcbiIsImFwcC5mYWN0b3J5KCdQb2xsRmFjdG9yeScsICgkaHR0cCkgPT4ge1xuICBmdW5jdGlvbiBkb3REYXRhKGRvdCkge1xuICAgIHJldHVybiBkb3QuZGF0YVxuICB9XG4gIHZhciBjYWNoZWRQb2xscyA9IFtdXG4gIHJldHVybiB7XG4gICAgZ2V0QWxsQnlMZWN0dXJlSWQ6IChpZCkgPT4ge1xuICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9wb2xsL2xlY3R1cmUvJytpZClcbiAgICAgIC50aGVuKGRvdERhdGEpXG4gICAgICAudGhlbigocG9sbHMpID0+IHtcbiAgICAgICAgYW5ndWxhci5jb3B5KHBvbGxzLCBjYWNoZWRQb2xscylcbiAgICAgICAgcmV0dXJuIGNhY2hlZFBvbGxzXG4gICAgICB9KVxuICAgIH0sXG4gICAgZ2V0T25lQnlQb2xsSWQ6IChpZCkgPT4ge1xuICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9wb2xsLycraWQpXG4gICAgICAudGhlbihkb3REYXRhKVxuICAgIH0sXG4gICAgY3JlYXRlUG9sbDogKHBvbGxPYmopID0+IHtcbiAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3BvbGwvJywgcG9sbE9iailcbiAgICAgIC50aGVuKGRvdERhdGEpXG4gICAgfSxcbiAgICB1cGRhdGVQb2xsOiAocG9sbE9iaiwgaWQpID0+IHtcbiAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvcG9sbC8nK2lkLCBwb2xsT2JqKVxuICAgICAgLnRoZW4oZG90RGF0YSlcbiAgICB9LFxuICAgIGRlbGV0ZVBvbGw6IChpZCkgPT4ge1xuICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL2FwaS9wb2xsLycraWQpXG4gICAgICAudGhlbihkb3REYXRhKVxuICAgICAgLnRoZW4oKHJlbW92ZWRQb2xsKSA9PiB7XG4gICAgICAgIGNhY2hlZFBvbGxzLnNwbGljZShjYWNoZWRQb2xscy5tYXAoZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaXRlbS5pZCB9KS5pbmRleE9mKGlkKSwxKVxuICAgICAgICByZXR1cm4gY2FjaGVkUG9sbHNcbiAgICAgIH0pXG4gICAgfVxuICB9XG59KVxuIiwiYXBwLmRpcmVjdGl2ZSgncXVlc3Rpb24nLCBmdW5jdGlvbigkc3RhdGUsIFF1ZXN0aW9uRmFjdG9yeSkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL2NvbW1vbi9xdWVzdGlvbi9xdWVzdGlvbi5odG1sJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUpIHtcblxuICAgICAgICAgICAgUXVlc3Rpb25GYWN0b3J5LmdldEFsbEJ5TGVjdHVyZUlkKDEpLnRoZW4oZnVuY3Rpb24ocXVlc3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zID0gcXVlc3Rpb25zLmZpbHRlcihmdW5jdGlvbihxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxLnN0YXR1cyA9PT0gJ29wZW4nXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmRJbmRleChxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcGUucXVlc3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5xdWVzdGlvbnNbaV0udGV4dCA9PT0gcXVlc3Rpb24udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBtb3ZlKHF1ZXN0aW9uLCBuKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCtuID4gLTEgJiYgaW5kZXgrbiA8IHNjb3BlLnF1ZXN0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucXVlc3Rpb25zLnNwbGljZShpbmRleCtuLCAwLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uZXdRdWVzdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSB7dGV4dDogc2NvcGUubmV3UXVlc3Rpb24sIHN1Ym1pdFRpbWU6IERhdGUubm93KCksIHVwdm90ZXM6IDB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBRdWVzdGlvbkZhY3Rvcnkuc3RvcmUocXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24ocSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2FkZGluZ1F1ZXN0aW9uJywgcSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ld1F1ZXN0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2RlbGV0aW5nUXVlc3Rpb24nLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICByZXR1cm4gUXVlc3Rpb25GYWN0b3J5LmRlbGV0ZShxdWVzdGlvbilcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnN0YXR1cyA9ICdjbG9zZWQnXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2RlbGV0aW5nUXVlc3Rpb24nLCBxdWVzdGlvbilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS5tb3ZlID0gZnVuY3Rpb24ocXVlc3Rpb24sIG4pIHtcbiAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnbW92ZScsIHF1ZXN0aW9uLCBuKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS51cHZvdGUgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmhhc1Vwdm90ZWQgPSAhcXVlc3Rpb24uaGFzVXB2b3RlZDtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi51cHZvdGVzKys7XG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3Vwdm90aW5nJywgcXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmRvd252b3RlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi5oYXNVcHZvdGVkID0gIXF1ZXN0aW9uLmhhc1Vwdm90ZWQ7XG4gICAgICAgICAgICAgICAgcXVlc3Rpb24udXB2b3Rlcy0tO1xuICAgICAgICAgICAgICAgIHNvY2tldC5lbWl0KCdkb3dudm90aW5nJywgcXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIFF1ZXN0aW9uRmFjdG9yeS51cGRhdGUocXVlc3Rpb24pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNvY2tldC5vbignYWRkUXVlc3Rpb24nLCBmdW5jdGlvbihxdWVzdGlvbikge1xuICAgICAgICAgICAgICAgIHNjb3BlLnF1ZXN0aW9ucy51bnNoaWZ0KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgc29ja2V0Lm9uKCdkZWxldGVRdWVzdGlvbicsIGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHF1ZXN0aW9uKVxuICAgICAgICAgICAgICAgIHNjb3BlLnF1ZXN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICAgICAgc2NvcGUuJGV2YWxBc3luYygpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBzb2NrZXQub24oJ3JlY2VpdmVkVXB2b3RlJywgZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgocXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gc2NvcGUucXVlc3Rpb25zW2luZGV4XVxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnVwdm90ZXMrK1xuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgc29ja2V0Lm9uKCdyZWNlaXZlZERvd252b3RlJywgZnVuY3Rpb24ocXVlc3Rpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgocXVlc3Rpb24pXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gc2NvcGUucXVlc3Rpb25zW2luZGV4XVxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnVwdm90ZXMtLTtcbiAgICAgICAgICAgICAgICBzY29wZS4kZXZhbEFzeW5jKClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHNvY2tldC5vbignbW92aW5nJywgZnVuY3Rpb24ocXVlc3Rpb24sIG4pIHtcbiAgICAgICAgICAgICAgICBtb3ZlKHF1ZXN0aW9uLCBuKVxuICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ1F1ZXN0aW9uRmFjdG9yeScsIGZ1bmN0aW9uICgkaHR0cCkge1xuXG5cdHZhciBvYmogPSB7fTtcblxuXHRvYmouZ2V0QWxsQnlMZWN0dXJlSWQgPSBmdW5jdGlvbihsZWN0dXJlSWQpIHtcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3F1ZXN0aW9uL2xlY3R1cmUvJyArIGxlY3R1cmVJZCkudGhlbihmdW5jdGlvbihyZXMpIHtcblx0XHRcdHJldHVybiByZXMuZGF0YTtcblx0XHR9KVxuXHR9XG5cblx0b2JqLnN0b3JlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcblx0XHRyZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbicsIHF1ZXN0aW9uKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xuXHRcdH0pXG5cdH1cblxuXHRvYmoudXBkYXRlID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcblx0XHRyZXR1cm4gJGh0dHAucHV0KCcvYXBpL3F1ZXN0aW9uLycgKyBxdWVzdGlvbi5pZCwgcXVlc3Rpb24pLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG5cdFx0XHRyZXR1cm4gcmVzLmRhdGE7XG5cdFx0fSlcblx0fVxuXG5cdG9iai5kZWxldGUgPSBmdW5jdGlvbihxdWVzdGlvbikge1xuXHRcdHJldHVybiAkaHR0cC5kZWxldGUoJy9hcGkvcXVlc3Rpb24vJyArIHF1ZXN0aW9uLmlkKS50aGVuKGZ1bmN0aW9uKHJlcykge1xuXHRcdFx0cmV0dXJuIHJlcy5kYXRhO1xuXHRcdH0pXG5cdH1cblxuXHRyZXR1cm4gb2JqO1xuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
